{{- $src := .Get "src" -}}
{{- $alt := .Get "alt" | default "" -}}
{{- $width := .Get "width" | default "1600" -}}
{{- $quality := .Get "q" | default "80" -}}
{{- $res := .Page.Resources.GetMatch $src -}}
{{- if not $res -}}
{{ errorf "imgproc: resource %q not found in %q" $src .Page.File.Path }}
{{- else -}}
{{- $img := $res.Resize (printf "%sx q%v webp" $width $quality) -}}
<img src="{{ $img.RelPermalink }}" alt="{{ $alt }}" width="{{ $img.Width }}" height="{{ $img.Height }}" loading="lazy" decoding="async" />
{{- end -}}
